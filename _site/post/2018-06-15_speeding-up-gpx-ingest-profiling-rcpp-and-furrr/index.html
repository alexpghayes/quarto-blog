<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex Hayes">
<meta name="dcterms.date" content="2018-06-15">

<title>speeding up GPX ingest: profiling, Rcpp and furrr – alex hayes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G6PQFW2XSK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-G6PQFW2XSK', { 'anonymize_ip': true});
</script>
<script src="../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="../../site_libs/jquery-1.12.4/jquery.min.js"></script>
<script src="../../site_libs/d3-3.5.6/d3.min.js"></script>
<link href="../../site_libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet">
<script src="../../site_libs/profvis-0.3.6.9000/profvis.js"></script>
<script src="../../site_libs/profvis-0.3.6.9000/scroll.js"></script>
<link href="../../site_libs/highlight-6.2.0/textmate.css" rel="stylesheet">
<script src="../../site_libs/highlight-6.2.0/highlight.js"></script>
<script src="../../site_libs/profvis-binding-0.3.7.9000/profvis.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="speeding up GPX ingest: profiling, Rcpp and furrr – alex hayes">
<meta property="og:description" content="a demonstration of how to profile r code on a toy problem">
<meta property="og:image" content="https://www.alexpghayes.com/post/2018-06-15_speeding-up-gpx-ingest-profiling-rcpp-and-furrr/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta property="og:site_name" content="alex hayes">
<meta name="twitter:title" content="speeding up GPX ingest: profiling, Rcpp and furrr – alex hayes">
<meta name="twitter:description" content="a demonstration of how to profile r code on a toy problem">
<meta name="twitter:image" content="https://www.alexpghayes.com/post/2018-06-15_speeding-up-gpx-ingest-profiling-rcpp-and-furrr/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta name="twitter:creator" content="@alexpghayes">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">alex hayes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code/index.html"> 
<span class="menu-text">code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks/index.html"> 
<span class="menu-text">talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume/index.html"> 
<span class="menu-text">resume</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/alexpghayes"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/alexpghayes/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">speeding up GPX ingest: profiling, Rcpp and furrr</h1>
            <p class="subtitle lead"></p><p>a demonstration of how to profile r code on a toy problem</p><p></p>
                                <div class="quarto-categories">
                <div class="quarto-category">code performance</div>
                <div class="quarto-category">rstats</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.alexpghayes.com">Alex Hayes</a> <a href="https://orcid.org/0000-0002-4985-5160" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 15, 2018</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-problem-tidying-trajectories-in-gpx-files" id="toc-the-problem-tidying-trajectories-in-gpx-files" class="nav-link active" data-scroll-target="#the-problem-tidying-trajectories-in-gpx-files">The problem: tidying trajectories in GPX files</a></li>
  <li><a href="#gpx-reader-version-0-using-plotkmlreadgpx" id="toc-gpx-reader-version-0-using-plotkmlreadgpx" class="nav-link" data-scroll-target="#gpx-reader-version-0-using-plotkmlreadgpx">GPX reader version 0: using plotKML::readGPX</a></li>
  <li><a href="#gpx-reader-version-1-no-more-plotkmlgpx" id="toc-gpx-reader-version-1-no-more-plotkmlgpx" class="nav-link" data-scroll-target="#gpx-reader-version-1-no-more-plotkmlgpx">GPX reader version 1: no more plotKML::GPX</a></li>
  <li><a href="#gpx-reader-version-2-no-more-tibble" id="toc-gpx-reader-version-2-no-more-tibble" class="nav-link" data-scroll-target="#gpx-reader-version-2-no-more-tibble">GPX reader version 2: no more tibble</a></li>
  <li><a href="#gpx-reader-version-3-now-with-more-xml2" id="toc-gpx-reader-version-3-now-with-more-xml2" class="nav-link" data-scroll-target="#gpx-reader-version-3-now-with-more-xml2">GPX reader version 3: now with more xml2</a></li>
  <li><a href="#gpx-reader-version-4-drop-into-rcpp" id="toc-gpx-reader-version-4-drop-into-rcpp" class="nav-link" data-scroll-target="#gpx-reader-version-4-drop-into-rcpp">GPX reader version 4: drop into Rcpp</a></li>
  <li><a href="#comparing-the-various-gpx-readers" id="toc-comparing-the-various-gpx-readers" class="nav-link" data-scroll-target="#comparing-the-various-gpx-readers">Comparing the various GPX readers</a></li>
  <li><a href="#embarrassing-parallelization-with-furrr" id="toc-embarrassing-parallelization-with-furrr" class="nav-link" data-scroll-target="#embarrassing-parallelization-with-furrr">Embarrassing parallelization with <code>furrr</code></a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up">Wrap Up</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/alexpghayes/quarto-blog/edit/main/post/2018-06-15_speeding-up-gpx-ingest-profiling-rcpp-and-furrr/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/alexpghayes/quarto-blog/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<p>This post is a casual case study in speeding up R code. I work through several iterations of a function to read and process GPS running data from Strava stored in the GPX format. Along the way I describe how to visualize code bottlenecks with <code>profvis</code> and briefly touch on fast compiled code with <code>Rcpp</code> and parallelization with <code>furrr</code>.</p>
<section id="the-problem-tidying-trajectories-in-gpx-files" class="level2">
<h2 class="anchored" data-anchor-id="the-problem-tidying-trajectories-in-gpx-files">The problem: tidying trajectories in GPX files</h2>
<p>I record my runs on my phone using Strava. Strava stores the GPS recordings in GPX files, which are XML files that follow some additional conventions. They start with some metadata and then contain a list of GPS readings taken at one second intervals with longitude, latitude, elevation and timestap information. I wanted to approximate my speed at each timestamp in the GPS record, as well as my distance traveled since the previous GPS recordings.</p>
<p>Below I have an example of a GPX file that contains three GPS readings. First I create a vector that contains the names off my GPX files, and then I subset to the files that contain running data. I choose to work with the third run as a canonical example, and show a subset of the recording with three GPS readings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># file contain run data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>act_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"post"</span>, <span class="st">"2018-06-15_speeding-up-gpx-ingest-profiling-rcpp-and-furrr"</span>, <span class="st">"2018-04-17-activities-alex"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>run_files <span class="ot">&lt;-</span> act_files[<span class="fu">str_detect</span>(act_files, <span class="st">"Run"</span>)]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># example file we'll work with</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> run_files[<span class="dv">3</span>]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># subset of example</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(fname)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>mini_idx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">5897</span><span class="sc">:</span><span class="dv">5899</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(all[mini_idx], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;gpx creator="StravaGPX Android" version="1.1" xmlns="http://www.topografix.com/GPX/1/1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"&gt;
 &lt;metadata&gt;
  &lt;time&gt;2017-10-31T17:58:22Z&lt;/time&gt;
 &lt;/metadata&gt;
 &lt;trk&gt;
  &lt;name&gt;analytically slow&lt;/name&gt;
  &lt;trkseg&gt;
   &lt;trkpt lat="29.7169490" lon="-95.3978210"&gt;
    &lt;ele&gt;14.1&lt;/ele&gt;
    &lt;time&gt;2017-10-31T17:58:22Z&lt;/time&gt;
   &lt;/trkpt&gt;
   &lt;trkpt lat="29.7168040" lon="-95.3977180"&gt;
    &lt;ele&gt;14.4&lt;/ele&gt;
    &lt;time&gt;2017-10-31T17:58:29Z&lt;/time&gt;
   &lt;/trkpt&gt;
   &lt;trkpt lat="29.7167480" lon="-95.3976890"&gt;
    &lt;ele&gt;14.5&lt;/ele&gt;
    &lt;time&gt;2017-10-31T17:58:30Z&lt;/time&gt;
   &lt;/trkpt&gt;
  &lt;/trkseg&gt;
 &lt;/trk&gt;
&lt;/gpx&gt;</code></pre>
</div>
</div>
<p>The part we want is in the <code>&lt;trkseg&gt;</code> tags. We’d like to turn this into a tidy dataframe where each row represents one GPS reading and the columns contain information like speed, distance, traveled, elevation gained, etc.</p>
</section>
<section id="gpx-reader-version-0-using-plotkmlreadgpx" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="gpx-reader-version-0-using-plotkmlreadgpx">GPX reader version 0: using plotKML::readGPX</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>plotKML</code> was archived from CRAN on 2022-04-18 and the archived version isn’t easy to install. I’ve pulled the source for the <code>readGPX()</code> function and inserted it below to avoid depending on the <code>plotKML</code> package as of 2022-04-29.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(XML)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>readGPX <span class="ot">&lt;-</span> <span class="cf">function</span>(gpx.file,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">metadata =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">bounds =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">waypoints =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">tracks =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">routes =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  opt <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(gpx.file)) <span class="fu">stop</span>(<span class="st">"The file '"</span>, gpx.file, <span class="st">"'</span><span class="sc">\n</span><span class="st">  does not exist in "</span>, <span class="fu">getwd</span>())</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (metadata <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    metadata <span class="ot">&lt;-</span> <span class="fu">.readGPX.element</span>(gpx.file, <span class="st">"name"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (bounds <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    bounds <span class="ot">&lt;-</span> <span class="fu">.readGPX.element</span>(gpx.file, <span class="st">"bounds"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (waypoints <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    waypoints <span class="ot">&lt;-</span> <span class="fu">.readGPX.element</span>(gpx.file, <span class="st">"wpt"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tracks <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    tracks <span class="ot">&lt;-</span> <span class="fu">.readGPX.element</span>(gpx.file, <span class="st">"trk"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (routes <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    routes <span class="ot">&lt;-</span> <span class="fu">.readGPX.element</span>(gpx.file, <span class="st">"rte"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  gpx <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">metadata =</span> metadata, <span class="at">bounds =</span> bounds, <span class="at">waypoints =</span> waypoints, <span class="at">tracks =</span> tracks, <span class="at">routes =</span> routes)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gpx)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">options</span>(opt))</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Read various elements from a *.gpx file:</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>.readGPX.element <span class="ot">&lt;-</span> <span class="cf">function</span>(gpx.file, element) {</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># element = "metadata", "wpt", "rte", "trk"</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <span class="fu">xmlTreeParse</span>(gpx.file, <span class="at">useInternalNodes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># top structure:</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  top <span class="ot">&lt;-</span> <span class="fu">xmlRoot</span>(ret)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if there is any content:</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grep</span>(element, <span class="fu">names</span>(top)))) {</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tracks:</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (element <span class="sc">==</span> <span class="st">"trk"</span>) {</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>      ret <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>      nu <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top) <span class="sc">%in%</span> element)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (c <span class="cf">in</span> <span class="fu">seq_along</span>(nu)) {</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        lst <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top[[nu[c]]]) <span class="sc">%in%</span> <span class="st">"trkseg"</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="fu">names</span>(top[[nu[c]]][[lst[<span class="dv">1</span>]]][[<span class="dv">1</span>]])</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        ret[[c]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lst)) {</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>          trkpt <span class="ot">&lt;-</span> top[[nu[c]]][[lst[i]]]</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>          ret[[c]][[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>          <span class="do">## get columns (https://www.topografix.com/GPX/1/1/#type_wptType)</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>          lon <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlSApply</span>(trkpt, xmlGetAttr, <span class="st">"lon"</span>))</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>          lat <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlSApply</span>(trkpt, xmlGetAttr, <span class="st">"lat"</span>))</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>          ret[[c]][[i]][<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lon), <span class="st">"lon"</span>] <span class="ot">&lt;-</span> lon</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>          ret[[c]][[i]][<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lat), <span class="st">"lat"</span>] <span class="ot">&lt;-</span> lat</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span>nm[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">"NULL"</span>) {</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nm)) {</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>              xm <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">sapply</span>(<span class="fu">sapply</span>(<span class="fu">xmlChildren</span>(trkpt), <span class="cf">function</span>(x) x[[nm[[j]]]]), xmlValue))</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>              ret[[c]][[i]][<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(xm), nm[[j]]] <span class="ot">&lt;-</span> xm</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(ret[[c]]) <span class="ot">&lt;-</span> <span class="fu">xmlValue</span>(top[[nu[c]]][[<span class="st">"name"</span>]])</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (element <span class="sc">==</span> <span class="st">"wpt"</span>) {</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>      ret <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>      nu <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top) <span class="sc">%in%</span> element)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>      nm <span class="ot">&lt;-</span> <span class="fu">names</span>(top[[nu[<span class="dv">1</span>]]])</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(nu)) {</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># coordinates:</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        ret[i, <span class="st">"lon"</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(top[[nu[i]]], <span class="st">"lon"</span>))</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        ret[i, <span class="st">"lat"</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(top[[nu[i]]], <span class="st">"lat"</span>))</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span>nm[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">"NULL"</span>) {</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nm)) {</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>            ret[i, nm[[j]]] <span class="ot">&lt;-</span> <span class="fu">xmlValue</span>(<span class="fu">xmlChildren</span>(top[[nu[i]]])[[nm[[j]]]])</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (element <span class="sc">==</span> <span class="st">"rte"</span>) {</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>      ret <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>      nu <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top) <span class="sc">%in%</span> element)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (c <span class="cf">in</span> <span class="fu">seq_along</span>(nu)) {</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        ret[[c]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        lst <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top[[nu[c]]]) <span class="sc">%in%</span> <span class="st">"rtept"</span>)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="fu">names</span>(top[[nu[c]]][[lst[<span class="dv">1</span>]]])</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lst)) {</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>          rtept <span class="ot">&lt;-</span> top[[nu[c]]][[lst[i]]]</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>          ret[[c]][i, <span class="st">"lon"</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(rtept, <span class="st">"lon"</span>))</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>          ret[[c]][i, <span class="st">"lat"</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(rtept, <span class="st">"lat"</span>))</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="sc">!</span>nm[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">"NULL"</span>) {</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"cmt"</span>, <span class="st">"desc"</span>, <span class="st">"sym"</span>, <span class="st">"type"</span>)) {</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>              <span class="fu">try</span>(ret[[c]][i, j] <span class="ot">&lt;-</span> <span class="fu">xmlValue</span>(rtept[[j]]), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(ret)[c] <span class="ot">&lt;-</span> <span class="fu">xmlValue</span>(top[[nu[c]]][[<span class="st">"name"</span>]])</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bounds</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (element <span class="sc">==</span> <span class="st">"bounds"</span>) {</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>      nu <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top) <span class="sc">%in%</span> element)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>      ret <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"lat"</span>, <span class="st">"lon"</span>), <span class="fu">c</span>(<span class="st">"min"</span>, <span class="st">"max"</span>)))</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>      <span class="co"># coordinates:</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>      ret[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(top[[nu[<span class="dv">1</span>]]], <span class="st">"minlon"</span>))</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>      ret[<span class="dv">1</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(top[[nu[<span class="dv">1</span>]]], <span class="st">"maxlon"</span>))</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>      ret[<span class="dv">2</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(top[[nu[<span class="dv">1</span>]]], <span class="st">"minlat"</span>))</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>      ret[<span class="dv">2</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">xmlGetAttr</span>(top[[nu[<span class="dv">1</span>]]], <span class="st">"maxlat"</span>))</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># metadata</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (element <span class="sc">==</span> <span class="st">"name"</span>) {</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"desc"</span>, <span class="st">"author"</span>, <span class="st">"email"</span>, <span class="st">"url"</span>, <span class="st">"urlname"</span>, <span class="st">"time"</span>)</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>      nu <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(top) <span class="sc">%in%</span> lst)</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>nu[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">"NULL"</span>) {</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>        ret <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lst)) {</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>          <span class="fu">try</span>(ret[<span class="dv">1</span>, lst[i]] <span class="ot">&lt;-</span> <span class="fu">xmlValue</span>(top[[nu[[i]]]]), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using <code>plotKML::readGPX</code> we can read the representative file into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gps_raw <span class="ot">&lt;-</span> <span class="fu">readGPX</span>(fname)<span class="sc">$</span>tracks[[<span class="dv">1</span>]][[<span class="dv">1</span>]]  <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>gps_raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,472 × 4
     lon   lat ele   time                
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;               
 1 -95.4  29.7 14.1  2017-10-31T17:58:22Z
 2 -95.4  29.7 14.4  2017-10-31T17:58:29Z
 3 -95.4  29.7 14.5  2017-10-31T17:58:30Z
 4 -95.4  29.7 14.6  2017-10-31T17:58:31Z
 5 -95.4  29.7 14.6  2017-10-31T17:58:32Z
 6 -95.4  29.7 14.7  2017-10-31T17:58:33Z
 7 -95.4  29.7 14.7  2017-10-31T17:58:34Z
 8 -95.4  29.7 14.7  2017-10-31T17:58:36Z
 9 -95.4  29.7 14.7  2017-10-31T17:58:37Z
10 -95.4  29.7 14.7  2017-10-31T17:58:38Z
# … with 1,462 more rows</code></pre>
</div>
</div>
<p>Now we can we correct the type information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>retyped <span class="ot">&lt;-</span> gps_raw <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(lon, lat, ele), as.numeric) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(time), lubridate<span class="sc">::</span>ymd_hms)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>retyped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,472 × 4
     lon   lat   ele time               
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;             
 1 -95.4  29.7  14.1 2017-10-31 17:58:22
 2 -95.4  29.7  14.4 2017-10-31 17:58:29
 3 -95.4  29.7  14.5 2017-10-31 17:58:30
 4 -95.4  29.7  14.6 2017-10-31 17:58:31
 5 -95.4  29.7  14.6 2017-10-31 17:58:32
 6 -95.4  29.7  14.7 2017-10-31 17:58:33
 7 -95.4  29.7  14.7 2017-10-31 17:58:34
 8 -95.4  29.7  14.7 2017-10-31 17:58:36
 9 -95.4  29.7  14.7 2017-10-31 17:58:37
10 -95.4  29.7  14.7 2017-10-31 17:58:38
# … with 1,462 more rows</code></pre>
</div>
</div>
<p>We want to compare location at <span class="math inline">\(t\)</span> and <span class="math inline">\(t - 1\)</span>, so we create a lagged column of longitudes and latitudes. We put longitude and latitude together into a vector to play well with <code>raster::pointDistance</code>, which we’ll use to compute the great circle distance between two points.</p>
<div class="cell column-body-outset">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lagged <span class="ot">&lt;-</span> retyped <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">map2</span>(lon, lat, c), <span class="co"># create lagged position, this means the</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_old =</span> <span class="fu">lag</span>(x),        <span class="co"># first row isn't complete</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_old =</span> <span class="fu">lag</span>(time)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="co"># remove incomplete first row</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>lagged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,471 × 7
     lon   lat   ele time                x         x_old     t_old              
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;              &lt;list&gt;    &lt;list&gt;    &lt;dttm&gt;             
 1 -95.4  29.7  14.4 2017-10-31 17:58:29 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:22
 2 -95.4  29.7  14.5 2017-10-31 17:58:30 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:29
 3 -95.4  29.7  14.6 2017-10-31 17:58:31 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:30
 4 -95.4  29.7  14.6 2017-10-31 17:58:32 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:31
 5 -95.4  29.7  14.7 2017-10-31 17:58:33 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:32
 6 -95.4  29.7  14.7 2017-10-31 17:58:34 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:33
 7 -95.4  29.7  14.7 2017-10-31 17:58:36 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:34
 8 -95.4  29.7  14.7 2017-10-31 17:58:37 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:36
 9 -95.4  29.7  14.7 2017-10-31 17:58:38 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:37
10 -95.4  29.7  14.7 2017-10-31 17:58:39 &lt;dbl [2]&gt; &lt;dbl [2]&gt; 2017-10-31 17:58:38
# … with 1,461 more rows</code></pre>
</div>
</div>
<p>It turns out this data is not contiguous. Strava has a feature called autopause which detects pauses in runs (for example, at a stoplight), and GPS readings during paused periods are not include in the GPX files<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. GPS readings typically happen once every second. I plotted the time gaps between readings and realized that time gaps greater than three seconds between two GPS recordings indicated a pause. This lets me break the run down into a series of contigous segments:</p>
<div class="cell column-body-outset">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>segmented <span class="ot">&lt;-</span> lagged <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rest =</span> <span class="fu">as.numeric</span>(time <span class="sc">-</span> t_old), <span class="co"># seconds</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_segment =</span> <span class="fu">as.numeric</span>(rest <span class="sc">&gt;</span> <span class="dv">3</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment =</span> <span class="fu">cumsum</span>(new_segment)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># don't want t_old to be from previous segment</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>segmented</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,464 × 10
# Groups:   segment [5]
     lon   lat   ele time                x      x_old  t_old                rest
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;              &lt;list&gt; &lt;list&gt; &lt;dttm&gt;              &lt;dbl&gt;
 1 -95.4  29.7  14.5 2017-10-31 17:58:30 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:29     1
 2 -95.4  29.7  14.6 2017-10-31 17:58:31 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:30     1
 3 -95.4  29.7  14.6 2017-10-31 17:58:32 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:31     1
 4 -95.4  29.7  14.7 2017-10-31 17:58:33 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:32     1
 5 -95.4  29.7  14.7 2017-10-31 17:58:34 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:33     1
 6 -95.4  29.7  14.7 2017-10-31 17:58:36 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:34     2
 7 -95.4  29.7  14.7 2017-10-31 17:58:37 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:36     1
 8 -95.4  29.7  14.7 2017-10-31 17:58:38 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:37     1
 9 -95.4  29.7  14.7 2017-10-31 17:58:39 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:38     1
10 -95.4  29.7  14.6 2017-10-31 17:58:40 &lt;dbl&gt;  &lt;dbl&gt;  2017-10-31 17:58:39     1
# … with 1,454 more rows, and 2 more variables: new_segment &lt;dbl&gt;,
#   segment &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now I calculate some information about each time point and segment that I’ll use in downstream analyses:</p>
<div class="cell column-body-outset">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lonlat_dist <span class="ot">&lt;-</span> <span class="fu">partial</span>(raster<span class="sc">::</span>pointDistance, <span class="at">lonlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>useful <span class="ot">&lt;-</span> segmented <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">seg_length =</span> <span class="fu">max</span>(time) <span class="sc">-</span> <span class="fu">min</span>(t_old),  <span class="co"># seconds</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dx =</span> <span class="fu">map2_dbl</span>(x, x_old, lonlat_dist), <span class="co"># meters</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dx =</span> <span class="fl">0.000621371</span> <span class="sc">*</span> dx,                <span class="co"># miles</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dt =</span> rest <span class="sc">/</span> <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span>,                     <span class="co"># hours</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> dx <span class="sc">/</span> dt,                      <span class="co"># mph</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pace =</span> <span class="dv">60</span> <span class="sc">*</span> dt <span class="sc">/</span> dx,                  <span class="co"># min / mile</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">elev =</span> <span class="fu">as.numeric</span>(ele)                <span class="co"># feet</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ele, <span class="sc">-</span>x, <span class="sc">-</span>x_old, <span class="sc">-</span>t_old, <span class="sc">-</span>new_segment, <span class="sc">-</span>rest) <span class="sc">|&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>useful</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,464 × 10
     lon   lat time                seg…¹ seg…²      dx      dt speed  pace  elev
   &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;drt&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 -95.4  29.7 2017-10-31 17:58:30     1 510 … 0.00423 2.78e-4 15.2   3.94  14.5
 2 -95.4  29.7 2017-10-31 17:58:31     1 510 … 0.00367 2.78e-4 13.2   4.54  14.6
 3 -95.4  29.7 2017-10-31 17:58:32     1 510 … 0.00197 2.78e-4  7.11  8.44  14.6
 4 -95.4  29.7 2017-10-31 17:58:33     1 510 … 0.00483 2.78e-4 17.4   3.45  14.7
 5 -95.4  29.7 2017-10-31 17:58:34     1 510 … 0.00230 2.78e-4  8.28  7.25  14.7
 6 -95.4  29.7 2017-10-31 17:58:36     1 510 … 0.00410 5.56e-4  7.38  8.13  14.7
 7 -95.4  29.7 2017-10-31 17:58:37     1 510 … 0.00243 2.78e-4  8.75  6.86  14.7
 8 -95.4  29.7 2017-10-31 17:58:38     1 510 … 0.00316 2.78e-4 11.4   5.27  14.7
 9 -95.4  29.7 2017-10-31 17:58:39     1 510 … 0.00415 2.78e-4 15.0   4.01  14.7
10 -95.4  29.7 2017-10-31 17:58:40     1 510 … 0.00363 2.78e-4 13.1   4.60  14.6
# … with 1,454 more rows, and abbreviated variable names ¹​segment, ²​seg_length</code></pre>
</div>
</div>
<p>We can quickly visualize instantaneous speed throughout the run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(useful, <span class="fu">aes</span>(time, speed, <span class="at">group =</span> segment)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Speed throughout example run"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Speed (mph)"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see two short pauses present in the run at around 18:08 and 18:17.</p>
<p>We’re going to use the code above a whole bunch, so we wrap it up into a helper function. I’m not sure that <code>raster::pointDistance</code> is the best option for calculating the distance between two points, so we use a <code>dist_func</code> argument to make it easy to switch out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>get_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(gps_df, <span class="at">dist_func =</span> lonlat_dist) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  gps_df <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="fu">vars</span>(lon, lat, ele), as.numeric) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="fu">vars</span>(time), lubridate<span class="sc">::</span>ymd_hms) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">map2</span>(lon, lat, c),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x_old =</span> <span class="fu">lag</span>(x),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">t_old =</span> <span class="fu">lag</span>(time)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">rest =</span> <span class="fu">as.numeric</span>(time <span class="sc">-</span> t_old),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">new_segment =</span> <span class="fu">as.numeric</span>(rest <span class="sc">&gt;</span> <span class="dv">3</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">segment =</span> <span class="fu">cumsum</span>(new_segment) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(segment) <span class="sc">|&gt;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">seg_length =</span> <span class="fu">max</span>(time) <span class="sc">-</span> <span class="fu">min</span>(t_old),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">dx =</span> <span class="fu">map2_dbl</span>(x, x_old, dist_func),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">dx =</span> <span class="fl">0.000621371</span> <span class="sc">*</span> dx,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">dt =</span> rest <span class="sc">/</span> <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">speed =</span> dx <span class="sc">/</span> dt,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">pace =</span> <span class="dv">60</span> <span class="sc">*</span> dt <span class="sc">/</span> dx,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">elev =</span> <span class="fu">as.numeric</span>(ele)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ele, <span class="sc">-</span>x, <span class="sc">-</span>x_old, <span class="sc">-</span>t_old, <span class="sc">-</span>new_segment, <span class="sc">-</span>rest) <span class="sc">|&gt;</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This means our initial <code>read_gpx</code> function is just two lines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>read_gpx0 <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  gps_df <span class="ot">&lt;-</span> <span class="fu">readGPX</span>(fname)<span class="sc">$</span>tracks[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_metrics</span>(gps_df)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use <code>profvis::profvis</code> to create an interactive visualization of how long it takes to read the example file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(profvis)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>(<span class="fu">read_gpx0</span>(fname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-1a4f95264500f1708431" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-1a4f95264500f1708431">{"x":{"message":{"prof":{"time":[1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,13,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,19,20,20,20,20,20,21,21,21,21,22,23,23],"depth":[1,6,5,4,3,2,1,8,7,6,5,4,3,2,1,6,5,4,3,2,1,1,8,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,6,5,4,3,2,1,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,1,8,7,6,5,4,3,2,1,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,1,5,4,3,2,1,4,3,2,1,1,2,1],"label":[".Call","lapply","sapply","xmlSApply.XMLInternalNode",".readGPX.element","readGPX","read_gpx0","grep","FUN","lapply","sapply","xmlSApply.XMLInternalNode",".readGPX.element","readGPX","read_gpx0","lapply","sapply","xmlSApply.XMLInternalNode",".readGPX.element","readGPX","read_gpx0",".Call","is","[[.XMLInternalElementNode","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0","is","[[.XMLInternalElementNode","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0","is","[[.XMLInternalElementNode","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0","is","[[.XMLInternalNode","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0","getClassDef","is","[[.XMLInternalElementNode","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0","getClassDef","is","[[.XMLInternalElementNode","FUN","lapply","sapply",".readGPX.element","readGPX","read_gpx0",".Call","tolower","getEncodingREnum","xmlValue.XMLInternalNode","lapply","sapply",".readGPX.element","readGPX","read_gpx0","findCenvVar","getInlineInfo","tryInline","cmpCall","cmp","genCode","cmpCallArgs","cmpCallSymFun","cmpCall","cmp","genCode","cmpCallArgs","cmpCallExprFun","cmpCall","cmp","genCode","cmpCallArgs","cmpCallSymFun","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","sys.calls","add_handler","defer","local_bindings","walk_data_tree","reduce_sels","eval_c","walk_data_tree","vars_select_eval","eval_select_impl","tidyselect::vars_select","tbl_at_vars","tbl_at_syms","manip_at","mutate_at","get_metrics","read_gpx0","regexpr",".strptime","FUN","lapply",".train_formats",".best_formats",".local_parse","parse_date_time",".parse_xxx_hms","<Anonymous>","enexpr","inject","%<~%","env_get","...length2","impl","standardGeneric","cbind",".geodist",".fn",".f","map2_dbl",".pointsToMatrix",".fn",".f","map2_dbl",".Call","<GC>","...length"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"memalloc":[33.709098815918,33.9878540039062,33.9878540039062,33.9878540039062,33.9878540039062,33.9878540039062,33.9878540039062,34.3199310302734,34.3199310302734,34.3199310302734,34.3199310302734,34.3199310302734,34.3199310302734,34.3199310302734,34.3199310302734,34.8319244384766,34.8319244384766,34.8319244384766,34.8319244384766,34.8319244384766,34.8319244384766,35.0716705322266,35.5710144042969,35.5710144042969,35.5710144042969,35.5710144042969,35.5710144042969,35.5710144042969,35.5710144042969,35.5710144042969,35.708381652832,35.708381652832,35.708381652832,35.708381652832,35.708381652832,35.708381652832,35.708381652832,35.708381652832,35.7989120483398,35.7989120483398,35.7989120483398,35.7989120483398,35.7989120483398,35.7989120483398,35.7989120483398,35.7989120483398,36.1523818969727,36.1523818969727,36.1523818969727,36.1523818969727,36.1523818969727,36.1523818969727,36.6578598022461,36.6578598022461,36.6578598022461,36.6578598022461,36.6578598022461,36.6578598022461,36.6578598022461,36.6578598022461,36.7934417724609,36.7934417724609,36.7934417724609,36.7934417724609,36.7934417724609,36.7934417724609,36.7934417724609,36.7934417724609,36.7934417724609,36.8831558227539,36.8831558227539,36.8831558227539,36.8831558227539,36.8831558227539,36.8831558227539,36.8831558227539,36.8831558227539,36.8831558227539,37.1541213989258,37.4100952148438,37.4100952148438,37.4100952148438,37.4100952148438,37.4100952148438,37.4100952148438,37.4100952148438,37.4100952148438,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.7899627685547,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,37.950553894043,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,40.8407363891602,41.4343490600586,41.4343490600586,41.4343490600586,41.4343490600586,41.4343490600586,41.4343490600586,42.9339370727539,43.8164138793945,43.8164138793945,43.8164138793945,43.8164138793945,43.8164138793945,45.1668701171875,45.1668701171875,45.1668701171875,45.1668701171875,45.9603881835938,47.0334625244141,47.0334625244141],"meminc":[0,0.278755187988281,0,0,0,0,0,0.332077026367188,0,0,0,0,0,0,0,0.511993408203125,0,0,0,0,0,0.23974609375,0.499343872070312,0,0,0,0,0,0,0,0.137367248535156,0,0,0,0,0,0,0,0.0905303955078125,0,0,0,0,0,0,0,0.353469848632812,0,0,0,0,0,0.505477905273438,0,0,0,0,0,0,0,0.135581970214844,0,0,0,0,0,0,0,0,0.0897140502929688,0,0,0,0,0,0,0,0,0.270965576171875,0.255973815917969,0,0,0,0,0,0,0,0.379867553710938,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.160591125488281,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.89018249511719,0,0,0,0,0,0,0,0,0,0.593612670898438,0,0,0,0,0,1.49958801269531,0.882476806640625,0,0,0,0,1.35045623779297,0,0,0,0.79351806640625,1.07307434082031,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"interval":10,"files":[],"prof_output":"/tmp/RtmpPguRDA/file11b6d720c9c3c.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>In the default view, the horizontal axis represents time and the box represents the call stack. All the boxes above <code>plotKML::readGPX</code> are functions called by <code>plotKML::readGPX</code>. Here it seems like <code>plotKML::readGPX</code> takes about 400 milliseconds to run. So about half the time is spent reading in the file, and half calculating metrics. Most of the time calculating metrics is in <code>raster::pointDistance</code>, which is fairly up the call stack - you may have to click and drag the plot to see it.</p>
</section>
<section id="gpx-reader-version-1-no-more-plotkmlgpx" class="level2">
<h2 class="anchored" data-anchor-id="gpx-reader-version-1-no-more-plotkmlgpx">GPX reader version 1: no more plotKML::GPX</h2>
<p>Then I broke my R library and couldn’t use <code>plotKML::readGPX</code> for a little while. Since GPX files are XML files, I used the <code>xml2</code> package as a replacement. <code>xml2</code> has a function <code>as_list</code> that let me treat the XML as an R list. We extract the relevant portion of the list and <code>purrr::map_dfr</code> each GPS recording into a row of a <code>tibble</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>run_xml <span class="ot">&lt;-</span> <span class="fu">read_xml</span>(fname)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>run_list <span class="ot">&lt;-</span> <span class="fu">as_list</span>(run_xml)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>gps_pts <span class="ot">&lt;-</span> run_list<span class="sc">$</span>gpx<span class="sc">$</span>trk<span class="sc">$</span>trkseg</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>extract_gps_point <span class="ot">&lt;-</span> <span class="cf">function</span>(point) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">attr</span>(point, <span class="st">"lon"</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">attr</span>(point, <span class="st">"lat"</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ele =</span> point<span class="sc">$</span>ele[[<span class="dv">1</span>]],</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> point<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(gps_pts, extract_gps_point)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,472 × 4
   lon         lat        ele   time                
   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;               
 1 -95.3978210 29.7169490 14.1  2017-10-31T17:58:22Z
 2 -95.3977180 29.7168040 14.4  2017-10-31T17:58:29Z
 3 -95.3976890 29.7167480 14.5  2017-10-31T17:58:30Z
 4 -95.3976530 29.7167050 14.6  2017-10-31T17:58:31Z
 5 -95.3976600 29.7166770 14.6  2017-10-31T17:58:32Z
 6 -95.3976330 29.7166110 14.7  2017-10-31T17:58:33Z
 7 -95.3976090 29.7165850 14.7  2017-10-31T17:58:34Z
 8 -95.3975830 29.7165300 14.7  2017-10-31T17:58:36Z
 9 -95.3975780 29.7164950 14.7  2017-10-31T17:58:37Z
10 -95.3975630 29.7164510 14.7  2017-10-31T17:58:38Z
# … with 1,462 more rows</code></pre>
</div>
</div>
<p>Then we wrap this in a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>read_gpx1 <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  run_xml <span class="ot">&lt;-</span> <span class="fu">read_xml</span>(fname)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  run_list <span class="ot">&lt;-</span> <span class="fu">as_list</span>(run_xml)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  extract_gps_point <span class="ot">&lt;-</span> <span class="cf">function</span>(point) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">lon =</span> <span class="fu">attr</span>(point, <span class="st">"lon"</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat =</span> <span class="fu">attr</span>(point, <span class="st">"lat"</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">ele =</span> point<span class="sc">$</span>ele[[<span class="dv">1</span>]],</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> point<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  gps_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(run_list<span class="sc">$</span>gpx<span class="sc">$</span>trk<span class="sc">$</span>trkseg, extract_gps_point)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_metrics</span>(gps_df)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next part is critical when trying to speed up code: <strong>test that the new code does the same thing as the old code</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>expected <span class="ot">&lt;-</span> <span class="fu">read_gpx0</span>(fname)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>result_1 <span class="ot">&lt;-</span> <span class="fu">read_gpx1</span>(fname)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># silence means everything went well</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(expected, result_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This turned out to be too slow, so we profile and see which lines are taking the most amount of time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>(<span class="fu">read_gpx1</span>(fname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-74a8d36ffdeeb681dba1" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-74a8d36ffdeeb681dba1">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,36,37,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,38,38,38,38,39,39,39,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,44,44,44,45,45,45,45,45,45,45,45,46,46,46,46,46,46,46,46,46,46,46,46,46,47,48,48,48,48,48,48,49,49,49,49,49,49,49,49,49,49,49,49,49,49,49,50,51,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,53,53,53,53,54,55,55,55,55,55,55,55,55,55,55,55,55,55,56,56,56,56,56,56,56,56,56,56,56,56,56,57,57,57,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,58,58,58,58,58,59,59,59,59,59,59,59,59,59,59,59,59,59,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,61,61,61,61,61,62,63,63,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,64,64,64,64,64,64,65,65,65,65,65,65,66,66,66,66,66,66,66,66,66,66,66,66,66,67,68,68,68,68,68,68,68,68,69,69,69,69,69,69,69,69,69,70,70,70,70,70,70,70,70,70,70,70,70,70,71,71,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,72,72,72,72,72,73,73,73,73,73,73,73,74,74,74,74,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,75,75,75,75,75,76,76,76,76,76,76,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,77,77,78,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80,81,81,81,81,81,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,83,83,83,83,83,84,85,85,86,86,86,86,86,86,86,86,86,86,86,86,86,86,87,87,87,88,88,88,88,88,88,88,88,88,89,89,89,89,89,89,89,89,90,90,90,90,90,90,90,90,90,90,90,90,90,90,91,91,91,91,91,91,91,91,91,91,91,91,91,92,92,92,92,92,92,92,92,92,92,92,92,92,92,93,93,93,93,93,93,93,93,93,93,93,93,93,93,93,94,94,94,94,94,94,94,94,94,94,94,94,94,94,95,95,95,95,95,95,95,95,95,95,95,95,95,95,96,96,96,96,96,96,96,96,96,96,96,96,97,98,98,98,98,98,98,98,98,98,98,98,98,98,98,98,99,99,99,99,99,99,99,100,100,100,100,100,100,100,100,100,100,100,100,100,101,101,101,101,101,101,101,101,101,101,101,101,101,101,101,102,102,102,102,102,102,102,102,102,102,102,102,102,103,103,103,103,103,103,103,103,103,103,103,103,103,104,104,104,104,104,104,104,104,105,105,105,105,105,105,105,105,105,105,105,105,106,106,106,106,107,107,107,107,107,107,107,107,107,107,107,107,108,108,108,108,108,108,108,108,108,108,108,109,109,109,109,109,109,110,110,110,110,110,110,110,110,110,110,110,110,111,111,111,111,111,111,111,111,111,111,111,111,111,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,114,114,114,114,114,114,115,115,115,115,115,115,115,115,115,115,115,115,117,118,118,118,118,118,118,118,118,119,119,119,119,119,119,119,119,119,120,120,120,120,120,120,121,121,121,121,121,121,121,121,121,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,123,123,123,123,123,123,123,123,123,123,123,123,124,124,124,124,124,124,124,124,124,124,124,124,125,125,125,125,125,125,125,125,125,125,125,125,125,126,126,126,126,126,126,126,126,127,127,127,128,128,128,128,128,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,130,130,130,130,130,130,130,130,130,130,130,130,131,131,131,131,132,132,132,132,132,133,133,133,133,133,133,134,134,134,134,134,135,135,135,135,136,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137],"depth":[13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,3,2,1,1,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,3,2,1,8,7,6,5,4,3,2,1,10,9,8,7,6,5,4,3,2,1,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,3,2,1,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,1,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,1,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,1,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,1,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,10,9,8,7,6,5,4,3,2,1,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,1,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,3,2,1,9,8,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,11,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,1,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,3,2,1,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1,5,4,3,2,1,4,3,2,1,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],"label":["structure","FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","match.fun","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","[[","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","$","xml_attrs.xml_node","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","isTRUE","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","isTRUE","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","seq_along","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","FUN","vapply","xml_type.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","ifelse","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","as_list","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","list","xml_to_r_attrs","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","ifelse","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","nodeset_apply","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","FUN","vapply","xml_type.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","xml_attrs","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","FUN","vapply","xml_type.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","xml_type.xml_node","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","[[","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","ifelse","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","xml_type.xml_node","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","structure","FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","structure","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","nodeset_apply","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","[[","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","xml_type.xml_node","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","xml_attrs.xml_node","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx1","any","paste0","FUN","lapply","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","quo_squash_impl","quo_squash","as_label","caller_arg","arg_match0","exprs_auto_name","quos_auto_name","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","eval",".transformer","<Anonymous>",".Call","vapply","map_mold","map_lgl","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","isTRUE","which","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","parent.frame","tryCatch","<Anonymous>","add_to_env","add_to_env2","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","lapply","map","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","withCallingHandlers","subclass_name_repair_errors","repaired_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","<GC>","as.symbol","FUN","lapply","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","eval",".transformer","<Anonymous>","length","rep_along","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","lengths","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","length","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","grepl","has_newline","trim","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","length","environment","vec_size","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","drop_null","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","lapply","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".External2","recycle_columns","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","grep","detect_dot_dot","validate_unique","<Anonymous>","vec_as_names","repaired_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","isTRUE","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","has_names","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","new_tibble","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","as_glue.character","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","<Anonymous>","map_mold","map_lgl","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","recycle_columns","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","lengths","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".External2","<Anonymous>","new_tibble","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","map_mold","map_lgl","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","is_string","as_string","as_label","caller_arg","arg_match0","exprs_auto_name","quos_auto_name","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","has_length","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","do.call","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","rep_along","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","grep","detect_dot_dot","validate_unique","<Anonymous>","vec_as_names","repaired_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","paste0","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".External2","grepl","has_newline","trim","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".Call","FUN","lapply","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","has_newline","trim","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","environment","list2","<Anonymous>","mapply","map2","imap","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".External2",".transformer","<Anonymous>","vapply","drop_null","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","eval",".transformer","<Anonymous>","which","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","set_names","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","drop_null","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","do.call","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","drop_null","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","paste0","FUN","lapply","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","lengths","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","drop_null","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","is.numeric","grepl","has_newline","trim","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","new_tibble","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","has_names","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","replace","FUN","lapply","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","duplicate","quo_squash","as_label","caller_arg","arg_match0","exprs_auto_name","quos_auto_name","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","drop_null","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","structure","[.quosures","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","detect_dot_dot","validate_unique","<Anonymous>","vec_as_names","repaired_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","isTRUE","parse",".transformer","<Anonymous>","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","map_mold","map_lgl","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","validate_minimal_names","validate_unique","<Anonymous>","vec_as_names","repaired_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","grep","detect_dot_dot","validate_unique","<Anonymous>","vec_as_names","repaired_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","grepl","has_newline","trim","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","FUN","vapply","map_mold","map_lgl","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1",".External2","set_names","set_repaired_names","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","map","check_valid_cols","check_valid_col","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","recycle_columns","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","vapply","lengths","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","isTRUE","glue_data","glue::glue",".name_spec","<Anonymous>","vec_c","splice_dfs","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","structure","[.quosures","tibble_quos","tibble",".f","map","map_dfr","read_gpx1","eval",".transformer","<Anonymous>","lapply","map","dplyr::bind_rows","map_dfr","read_gpx1","sys.calls","add_handler","defer","local_bindings","walk_data_tree","reduce_sels","eval_c","walk_data_tree","vars_select_eval","eval_select_impl","tidyselect::vars_select","tbl_at_vars","tbl_at_syms","manip_at","mutate_at","get_metrics","read_gpx1","paste",".str_sub",".substitute_formats","<Anonymous>","mapply",".build_formats","guess_formats",".best_formats",".local_parse","parse_date_time",".parse_xxx_hms","<Anonymous>","dplyr_quosures","mutate.data.frame","get_metrics","read_gpx1","matrix",".pointsToMatrix",".fn",".f","map2_dbl","is.data.frame","colnames",".pointsToMatrix",".fn",".f","map2_dbl","colnames",".pointsToMatrix",".fn",".f","map2_dbl",".geodist",".fn",".f","map2_dbl",".Call","is_string","as_string","%<~%","env_get","eval_sym","walk_data_tree","reduce_sels","eval_c","walk_data_tree","vars_select_eval","eval_select_impl","tidyselect::eval_select","select.data.frame","get_metrics","read_gpx1"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"memalloc":[35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.7481460571289,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,35.9849166870117,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.2372741699219,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.4040985107422,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.656494140625,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,36.8233413696289,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.0728149414062,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.234489440918,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.4823455810547,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.6393203735352,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,37.8776931762695,38.0378952026367,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.2788467407227,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.4407424926758,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.6845474243164,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,38.8468933105469,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.0897369384766,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.2500686645508,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.4886627197266,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,39.6469421386719,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.4588012695312,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.6259841918945,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,35.8747863769531,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.0419845581055,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.2931518554688,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.4595184326172,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.7096252441406,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,36.874755859375,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.1176681518555,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.2762908935547,37.5146331787109,37.5146331787109,37.5146331787109,37.5146331787109,37.5146331787109,37.5146331787109,37.5146331787109,37.5146331787109,37.5146331787109,37.6551513671875,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.8446197509766,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,37.9700927734375,38.1582565307617,38.1582565307617,38.1582565307617,38.2855834960938,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.4760055541992,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.6020812988281,38.7927551269531,38.7927551269531,38.7927551269531,38.9195709228516,38.9195709228516,38.9195709228516,38.9195709228516,38.9195709228516,38.9195709228516,38.9195709228516,38.9195709228516,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.11083984375,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.2375640869141,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,39.3775787353516,35.5801162719727,35.5801162719727,35.5801162719727,35.7335662841797,35.7335662841797,35.7335662841797,35.7335662841797,35.7335662841797,35.7335662841797,35.7335662841797,35.7335662841797,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,35.8596725463867,36.0414962768555,36.1688537597656,36.1688537597656,36.1688537597656,36.1688537597656,36.1688537597656,36.1688537597656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.3622131347656,36.4906539916992,36.682373046875,36.682373046875,36.682373046875,36.682373046875,36.682373046875,36.682373046875,36.682373046875,36.682373046875,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.8089447021484,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,36.9986343383789,37.1247406005859,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.3093872070312,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.4342651367188,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.6243896484375,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.7519378662109,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,37.9429397583008,38.0688781738281,38.0688781738281,38.0688781738281,38.0688781738281,38.0688781738281,38.0688781738281,38.0688781738281,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.2594146728516,38.3865432739258,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.5752258300781,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.6990661621094,38.8857269287109,38.8857269287109,38.8857269287109,38.8857269287109,38.8857269287109,38.8857269287109,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.0107040405273,39.1993255615234,35.5478286743164,35.5478286743164,35.5478286743164,35.5478286743164,35.5478286743164,35.5478286743164,35.5478286743164,35.5478286743164,35.7323989868164,35.7323989868164,35.7323989868164,35.7323989868164,35.7323989868164,35.7323989868164,35.7323989868164,35.7323989868164,35.7323989868164,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,35.8404083251953,36.0234680175781,36.0234680175781,36.0234680175781,36.0234680175781,36.0234680175781,36.0234680175781,36.0234680175781,36.0234680175781,36.0234680175781,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.1508941650391,36.3442001342773,36.3442001342773,36.3442001342773,36.3442001342773,36.3442001342773,36.3442001342773,36.3442001342773,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.4729461669922,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.6651992797852,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.7926254272461,36.982421875,36.982421875,36.982421875,36.982421875,36.982421875,36.982421875,36.982421875,36.982421875,36.982421875,36.982421875,37.1088027954102,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.2962341308594,37.421142578125,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.6110229492188,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.7382049560547,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,37.9283218383789,38.054328918457,38.2451934814453,38.2451934814453,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.3724975585938,38.5640487670898,38.5640487670898,38.5640487670898,38.6921997070312,38.6921997070312,38.6921997070312,38.6921997070312,38.6921997070312,38.6921997070312,38.6921997070312,38.6921997070312,38.6921997070312,38.8837280273438,38.8837280273438,38.8837280273438,38.8837280273438,38.8837280273438,38.8837280273438,38.8837280273438,38.8837280273438,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.0107574462891,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,39.2023468017578,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.5763092041016,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.7664947509766,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,35.8953247070312,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.0892791748047,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.2192535400391,36.4137496948242,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.5432968139648,36.7361297607422,36.7361297607422,36.7361297607422,36.7361297607422,36.7361297607422,36.7361297607422,36.7361297607422,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,36.8640899658203,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.0540008544922,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.1799392700195,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.3667068481445,37.4924163818359,37.4924163818359,37.4924163818359,37.4924163818359,37.4924163818359,37.4924163818359,37.4924163818359,37.4924163818359,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.6825103759766,37.8100433349609,37.8100433349609,37.8100433349609,37.8100433349609,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.0013885498047,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.12890625,38.3204040527344,38.3204040527344,38.3204040527344,38.3204040527344,38.3204040527344,38.3204040527344,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.4478073120117,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.6392517089844,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,38.7656173706055,39.0852584838867,39.0852584838867,39.0852584838867,39.0852584838867,39.0852584838867,39.0852584838867,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,39.2767105102539,35.8453216552734,35.9730072021484,35.9730072021484,35.9730072021484,35.9730072021484,35.9730072021484,35.9730072021484,35.9730072021484,35.9730072021484,36.1686172485352,36.1686172485352,36.1686172485352,36.1686172485352,36.1686172485352,36.1686172485352,36.1686172485352,36.1686172485352,36.1686172485352,36.2993011474609,36.2993011474609,36.2993011474609,36.2993011474609,36.2993011474609,36.2993011474609,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.4942626953125,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.6234970092773,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.8165130615234,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,36.9458084106445,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.1371917724609,37.2637100219727,37.2637100219727,37.2637100219727,37.2637100219727,37.2637100219727,37.2637100219727,37.2637100219727,37.2637100219727,37.4506454467773,37.4506454467773,37.4506454467773,37.6109085083008,37.6109085083008,37.6109085083008,37.6109085083008,37.6109085083008,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,38.9038696289062,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,40.0104522705078,42.301025390625,42.301025390625,42.301025390625,42.301025390625,43.0776596069336,43.0776596069336,43.0776596069336,43.0776596069336,43.0776596069336,44.3752212524414,44.3752212524414,44.3752212524414,44.3752212524414,44.3752212524414,44.3752212524414,45.1011657714844,45.1011657714844,45.1011657714844,45.1011657714844,45.1011657714844,46.3711166381836,46.3711166381836,46.3711166381836,46.3711166381836,47.1959609985352,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008,48.4243850708008],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0.236770629882812,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.252357482910156,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.166824340820312,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.252395629882812,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.166847229003906,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.249473571777344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.161674499511719,0,0,0,0,0,0,0,0,0,0,0,0.247856140136719,0,0,0,0,0,0,0,0,0,0,0,0,0,0.156974792480469,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.238372802734375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.160202026367188,0.240951538085938,0,0,0,0,0,0,0,0,0,0,0,0.161895751953125,0,0,0,0,0,0,0,0,0,0,0,0.243804931640625,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.162345886230469,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.242843627929688,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.160331726074219,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.238594055175781,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.158279418945312,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-4.18814086914062,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.167182922363281,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.248802185058594,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.167198181152344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.251167297363281,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.166366577148438,0,0,0,0,0,0,0,0,0,0,0,0,0,0.250106811523438,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.165130615234375,0,0,0,0,0,0,0,0,0,0,0,0,0.242912292480469,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.158622741699219,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.23834228515625,0,0,0,0,0,0,0,0,0.140518188476562,0.189468383789062,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.125473022460938,0,0,0,0,0,0,0,0,0,0,0,0,0.188163757324219,0,0,0.127326965332031,0.190422058105469,0,0,0,0,0,0,0,0,0,0,0.126075744628906,0,0,0,0,0,0,0,0,0,0,0,0,0,0.190673828125,0,0,0.126815795898438,0,0,0,0,0,0,0,0.191268920898438,0,0,0,0,0,0,0,0,0,0.126724243164062,0,0,0,0,0,0,0,0,0,0.1400146484375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-3.79746246337891,0,0,0.153450012207031,0,0,0,0,0,0,0,0.126106262207031,0,0,0,0,0,0,0,0,0,0,0,0,0.18182373046875,0.127357482910156,0,0,0,0,0,0.193359375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.128440856933594,0.191719055175781,0,0,0,0,0,0,0,0.126571655273438,0,0,0,0,0,0,0,0,0,0,0,0,0.189689636230469,0,0,0,0,0,0,0,0,0,0,0,0,0.126106262207031,0.184646606445312,0,0,0,0,0,0,0,0,0,0,0,0,0.1248779296875,0,0,0,0,0,0,0,0,0,0,0,0,0.19012451171875,0,0,0,0,0,0,0,0,0,0,0,0.127548217773438,0,0,0,0,0,0,0,0,0,0,0,0,0.191001892089844,0,0,0,0,0,0,0,0,0,0,0,0,0.125938415527344,0,0,0,0,0,0,0.190536499023438,0,0,0,0,0,0,0,0,0,0,0,0,0.127128601074219,0.188682556152344,0,0,0,0,0,0,0,0,0,0.12384033203125,0,0,0,0,0,0,0,0,0,0,0,0,0,0.186660766601562,0,0,0,0,0,0.124977111816406,0,0,0,0,0,0,0,0,0,0,0,0,0.188621520996094,-3.65149688720703,0,0,0,0,0,0,0,0.1845703125,0,0,0,0,0,0,0,0,0.108009338378906,0,0,0,0,0,0,0,0,0,0,0,0,0.183059692382812,0,0,0,0,0,0,0,0,0.127426147460938,0,0,0,0,0,0,0,0,0,0,0,0,0.193305969238281,0,0,0,0,0,0,0.128746032714844,0,0,0,0,0,0,0,0,0,0,0,0.192253112792969,0,0,0,0,0,0,0,0,0,0,0,0,0.127426147460938,0,0,0,0,0,0,0,0,0,0,0,0,0.189796447753906,0,0,0,0,0,0,0,0,0,0.126380920410156,0.187431335449219,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.124908447265625,0.18988037109375,0,0,0,0,0,0,0,0,0,0,0,0,0,0.127182006835938,0,0,0,0,0,0,0,0,0,0,0,0,0,0.190116882324219,0,0,0,0,0,0,0,0,0,0,0,0,0.126007080078125,0.190864562988281,0,0.127304077148438,0,0,0,0,0,0,0,0,0,0,0,0,0,0.191551208496094,0,0,0.128150939941406,0,0,0,0,0,0,0,0,0.1915283203125,0,0,0,0,0,0,0,0.127029418945312,0,0,0,0,0,0,0,0,0,0,0,0,0,0.19158935546875,0,0,0,0,0,0,0,0,0,0,0,0,-3.62603759765625,0,0,0,0,0,0,0,0,0,0,0,0,0,0.190185546875,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.128829956054688,0,0,0,0,0,0,0,0,0,0,0,0,0,0.193954467773438,0,0,0,0,0,0,0,0,0,0,0,0,0,0.129974365234375,0,0,0,0,0,0,0,0,0,0,0,0.194496154785156,0.129547119140625,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.192832946777344,0,0,0,0,0,0,0.127960205078125,0,0,0,0,0,0,0,0,0,0,0,0,0.189910888671875,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.125938415527344,0,0,0,0,0,0,0,0,0,0,0,0,0.186767578125,0,0,0,0,0,0,0,0,0,0,0,0,0.125709533691406,0,0,0,0,0,0,0,0.190093994140625,0,0,0,0,0,0,0,0,0,0,0,0.127532958984375,0,0,0,0.19134521484375,0,0,0,0,0,0,0,0,0,0,0,0.127517700195312,0,0,0,0,0,0,0,0,0,0,0.191497802734375,0,0,0,0,0,0.127403259277344,0,0,0,0,0,0,0,0,0,0,0,0.191444396972656,0,0,0,0,0,0,0,0,0,0,0,0,0.126365661621094,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.31964111328125,0,0,0,0,0,0.191452026367188,0,0,0,0,0,0,0,0,0,0,0,-3.43138885498047,0.127685546875,0,0,0,0,0,0,0,0.195610046386719,0,0,0,0,0,0,0,0,0.130683898925781,0,0,0,0,0,0.194961547851562,0,0,0,0,0,0,0,0,0,0,0,0,0.129234313964844,0,0,0,0,0,0,0,0,0,0,0,0,0,0.193016052246094,0,0,0,0,0,0,0,0,0,0,0,0.129295349121094,0,0,0,0,0,0,0,0,0,0,0,0.191383361816406,0,0,0,0,0,0,0,0,0,0,0,0,0.126518249511719,0,0,0,0,0,0,0,0.186935424804688,0,0,0.160263061523438,0,0,0,0,1.29296112060547,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.10658264160156,0,0,0,0,0,0,0,0,0,0,0,2.29057312011719,0,0,0,0.776634216308594,0,0,0,0,1.29756164550781,0,0,0,0,0,0.725944519042969,0,0,0,0,1.26995086669922,0,0,0,0.824844360351562,1.22842407226562,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"interval":10,"files":[],"prof_output":"/tmp/RtmpPguRDA/file11b6d3d97559c.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here we see that we spend most of our time on the functions <code>as_list</code> and <code>tibble</code>.</p>
</section>
<section id="gpx-reader-version-2-no-more-tibble" class="level2">
<h2 class="anchored" data-anchor-id="gpx-reader-version-2-no-more-tibble">GPX reader version 2: no more tibble</h2>
<p><code>tibble</code>s are somewhat heavy objects, and we can bind lists together instead of <code>tibble</code>s, so let’s try that next. We only change one line from <code>read_gpx1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>read_gpx2 <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  run_xml <span class="ot">&lt;-</span> <span class="fu">read_xml</span>(fname)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  run_list <span class="ot">&lt;-</span> <span class="fu">as_list</span>(run_xml)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  extract_gps_point <span class="ot">&lt;-</span> <span class="cf">function</span>(point) {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">lon =</span> <span class="fu">attr</span>(point, <span class="st">"lon"</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat =</span> <span class="fu">attr</span>(point, <span class="st">"lat"</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">ele =</span> point<span class="sc">$</span>ele[[<span class="dv">1</span>]],</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">time =</span> point<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  gps_df <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(run_list<span class="sc">$</span>gpx<span class="sc">$</span>trk<span class="sc">$</span>trkseg, extract_gps_point)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_metrics</span>(gps_df)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>result_2 <span class="ot">&lt;-</span> <span class="fu">read_gpx2</span>(fname)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(expected, result_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our results are still as expected, which is good. We profile again to see if we’ve done any better, which we have. Now we’re at about 1.5 seconds instead of 2.5 seconds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>(<span class="fu">read_gpx2</span>(fname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-fe1e1c692d0bdb6e3015" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-fe1e1c692d0bdb6e3015">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,32,32,32,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,37,37,38,38,39,39,39,40,41,41,41,41,42,42,42,42,42,43,43,43,43,43,44,44,44,44,44,44],"depth":[12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1,13,12,11,10,9,8,7,6,5,4,3,2,1,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,11,10,9,8,7,6,5,4,3,2,1,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,13,12,11,10,9,8,7,6,5,4,3,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,9,8,7,6,5,4,3,2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,11,10,9,8,7,6,5,4,3,2,1,3,2,1,9,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,1,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,2,1,3,2,1,1,4,3,2,1,5,4,3,2,1,5,4,3,2,1,6,5,4,3,2,1],"label":["FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","vapply","xml_name.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","xml_type","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","any","vapply","xml_type.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","structure","FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","structure","FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","structure","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","[[","vapply","xml_type.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","ifelse","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","is.function","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","%in%","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","structure","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","xml_name.xml_node","vapply","xml_name.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","as_list","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","match.fun","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","<GC>","ifelse","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","isTRUE","which","ifelse","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","structure","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","length","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","structure","FUN","lapply","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","isTRUE","xml_nodeset","nodeset_apply.xml_node","xml_contents","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","[[","vapply","xml_type.xml_nodeset","as_list.xml_node","FUN","lapply","as_list.xml_node","FUN","lapply","as_list.xml_node","read_gpx2","as_mapper","map_dfr","read_gpx2","detect_void_name","is_named","FUN","vapply",".rlang_purrr_map_mold","map_lgl","dplyr::bind_rows","map_dfr","read_gpx2","vctrs::data_frame","FUN","lapply","map","dplyr::bind_rows","map_dfr","read_gpx2",".External2","sys.calls","add_handler","defer","local_bindings","walk_data_tree","reduce_sels","eval_c","walk_data_tree","vars_select_eval","eval_select_impl","tidyselect::vars_select","tbl_at_vars","tbl_at_syms","manip_at","mutate_at","get_metrics","read_gpx2","paste",".str_sub",".substitute_formats","<Anonymous>","mapply",".build_formats","guess_formats",".best_formats",".local_parse","parse_date_time",".parse_xxx_hms","<Anonymous>",".f","map2","%in%","as_mapper.default","map2_dbl",".Call",".pointsToMatrix",".fn",".f","map2_dbl","matrix",".pointsToMatrix",".fn",".f","map2_dbl","cbind",".geodist",".fn",".f","map2_dbl","<GC>","colnames",".pointsToMatrix",".fn",".f","map2_dbl"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"memalloc":[35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,35.983268737793,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.2115020751953,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.4658813476562,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.6344604492188,36.882453918457,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.0476684570312,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.2921447753906,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.4527130126953,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.6946334838867,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,37.8475189208984,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.0798797607422,38.236457824707,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.4740371704102,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.6311569213867,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,38.8719863891602,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.0298156738281,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.2653427124023,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.4211044311523,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.6618804931641,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.8172073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,39.9422073364258,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,35.7921524047852,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.0399398803711,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.2060775756836,36.4541168212891,36.4541168212891,36.4541168212891,36.4541168212891,36.4541168212891,36.4541168212891,36.4541168212891,36.4541168212891,36.4541168212891,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.6191787719727,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.8627395629883,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,36.9927368164062,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.2029800415039,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.3609313964844,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.5776901245117,37.7562103271484,37.7562103271484,37.7562103271484,38.1743087768555,38.1743087768555,38.1743087768555,38.1743087768555,38.1743087768555,38.1743087768555,38.1743087768555,38.1743087768555,38.1743087768555,38.4801330566406,38.4801330566406,38.4801330566406,38.4801330566406,38.4801330566406,38.4801330566406,38.4801330566406,40.4074935913086,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,40.7441787719727,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,42.9094848632812,43.8314590454102,43.8314590454102,44.8178253173828,44.8178253173828,44.8178253173828,45.6812744140625,47.0106048583984,47.0106048583984,47.0106048583984,47.0106048583984,47.8890609741211,47.8890609741211,47.8890609741211,47.8890609741211,47.8890609741211,49.1977081298828,49.1977081298828,49.1977081298828,49.1977081298828,49.1977081298828,48.0111999511719,48.0111999511719,48.0111999511719,48.0111999511719,48.0111999511719,48.0111999511719],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0.228233337402344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.254379272460938,0,0,0,0,0,0,0,0,0,0,0,0,0.1685791015625,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.247993469238281,0.165214538574219,0,0,0,0,0,0,0,0,0,0,0,0,0.244476318359375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.160568237304688,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.241920471191406,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.152885437011719,0,0,0,0,0,0,0,0,0,0,0,0,0,0.23236083984375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.156578063964844,0.237579345703125,0,0,0,0,0,0,0,0,0,0,0,0,0,0.157119750976562,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.240829467773438,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.157829284667969,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.235527038574219,0,0,0,0,0,0,0,0,0,0,0,0,0,0.15576171875,0,0,0,0,0,0,0,0,0,0,0.240776062011719,0,0,0,0,0,0,0,0,0,0,0.155326843261719,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.125,0,0,0,0,0,0,0,0,0,0,0,0,-4.15005493164062,0,0,0,0,0,0,0,0,0,0,0,0,0,0.247787475585938,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1661376953125,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.248039245605469,0,0,0,0,0,0,0,0,0.165061950683594,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.243560791015625,0,0,0,0,0,0,0,0,0,0,0,0.129997253417969,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.210243225097656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.157951354980469,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.216758728027344,0,0,0,0,0,0,0,0,0,0,0.178520202636719,0,0,0.418098449707031,0,0,0,0,0,0,0,0,0.305824279785156,0,0,0,0,0,0,1.92736053466797,0.336685180664062,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.16530609130859,0,0,0,0,0,0,0,0,0,0,0,0.921974182128906,0,0.986366271972656,0,0,0.863449096679688,1.32933044433594,0,0,0,0.878456115722656,0,0,0,0,1.30864715576172,0,0,0,0,-1.18650817871094,0,0,0,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"interval":10,"files":[],"prof_output":"/tmp/RtmpPguRDA/file11b6d5edd582a.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>I needed to this for about fifty files though, so this was still slow enough to be somewhat frustrating. Now <code>xml2::as_list</code> is really killing us.</p>
</section>
<section id="gpx-reader-version-3-now-with-more-xml2" class="level2">
<h2 class="anchored" data-anchor-id="gpx-reader-version-3-now-with-more-xml2">GPX reader version 3: now with more xml2</h2>
<p>Luckily, we can use <code>xml2</code> to manipulate the XML via a fast C package instead. For this next part I tried functions exported by <code>xml2</code> until they worked and occasionally read the documentation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>read_gpx_xml <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the interested nodes</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  run_xml <span class="ot">&lt;-</span> <span class="fu">read_xml</span>(fname)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  trk <span class="ot">&lt;-</span> <span class="fu">xml_child</span>(run_xml, <span class="dv">2</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  trkseg <span class="ot">&lt;-</span> <span class="fu">xml_child</span>(trk, <span class="dv">2</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  trkpts <span class="ot">&lt;-</span> <span class="fu">xml_children</span>(trkseg) <span class="co"># nodeset where each node is a GPS reading</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the longitude and latitude for each node</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  latlon_list <span class="ot">&lt;-</span> <span class="fu">xml_attrs</span>(trkpts)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  latlon <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, latlon_list)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the time and elevation for each node</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  ele_time_vec <span class="ot">&lt;-</span> <span class="fu">xml_text</span>(<span class="fu">xml_children</span>(trkpts))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  ele_time <span class="ot">&lt;-</span> <span class="fu">matrix</span>(ele_time_vec, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ele_time) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ele"</span>, <span class="st">"time"</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="fu">cbind</span>(latlon, ele_time))</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>read_gpx3 <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  gps_df <span class="ot">&lt;-</span> <span class="fu">read_gpx_xml</span>(fname) <span class="sc">|&gt;</span> </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(lon, lat, <span class="fu">everything</span>())</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_metrics</span>(gps_df)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>result_3 <span class="ot">&lt;-</span> <span class="fu">read_gpx3</span>(fname)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(expected, result_3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again we see if there’s anywhere else we can speed things up:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>(<span class="fu">read_gpx3</span>(fname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-0bdf1d39b3d77b4106b4" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-0bdf1d39b3d77b4106b4">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,10,10,10,10,10,11,11,11,11,12,13,13,13,13,13,13,13,13,13,13,13,13,13],"depth":[6,5,4,3,2,1,6,5,4,3,2,1,7,6,5,4,3,2,1,6,5,4,3,2,1,11,10,9,8,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,2,1,14,13,12,11,10,9,8,7,6,5,4,3,2,1,4,3,2,1,5,4,3,2,1,4,3,2,1,1,13,12,11,10,9,8,7,6,5,4,3,2,1],"label":["$","xml_attrs.xml_node","lapply","xml_attrs.xml_nodeset","read_gpx_xml","read_gpx3","[[","lapply","nodeset_apply.xml_nodeset","xml_children","read_gpx_xml","read_gpx3","FUN","lapply","make_nodeset","nodeset_apply.xml_nodeset","xml_children","read_gpx_xml","read_gpx3","isTRUE","xml_text.xml_node","vapply","xml_text.xml_nodeset","read_gpx_xml","read_gpx3","FUN","lapply","packageDescription","utils::packageVersion",".rlang_cli_compat",".rlang_cli_format_fallback","signal","lifecycle::signal_stage","mutate_at","get_metrics","read_gpx3","is_call","quo_is_call","expand_across","mutate_cols","mutate.data.frame","mutate_at","get_metrics","read_gpx3","<Anonymous>","<Anonymous>","is_symbol","as_string","as_label","caller_arg","arg_match0","new_duration","vec_ptype2.difftime.difftime","<Anonymous>","vec_cast_common","dplyr_vec_cast_common","mutate_cols","mutate.data.frame","get_metrics","read_gpx3","stopifnot",".fn",".f","map2_dbl","ncol",".pointsToMatrix",".fn",".f","map2_dbl","nrow",".fn",".f","map2_dbl","standardGeneric","vctrs::vec_as_subscript","as_indices_impl","as_indices_sel_impl","walk_data_tree","reduce_sels","eval_c","walk_data_tree","vars_select_eval","eval_select_impl","tidyselect::eval_select","select.data.frame","get_metrics","read_gpx3"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"memalloc":[36.3038024902344,36.3038024902344,36.3038024902344,36.3038024902344,36.3038024902344,36.3038024902344,36.5493392944336,36.5493392944336,36.5493392944336,36.5493392944336,36.5493392944336,36.5493392944336,37.1235275268555,37.1235275268555,37.1235275268555,37.1235275268555,37.1235275268555,37.1235275268555,37.1235275268555,37.4771881103516,37.4771881103516,37.4771881103516,37.4771881103516,37.4771881103516,37.4771881103516,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.7497253417969,37.9588775634766,37.9588775634766,37.9588775634766,37.9588775634766,37.9588775634766,37.9588775634766,37.9588775634766,37.9588775634766,40.9804916381836,40.9804916381836,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,41.6509170532227,43.0844650268555,43.0844650268555,43.0844650268555,43.0844650268555,43.9531555175781,43.9531555175781,43.9531555175781,43.9531555175781,43.9531555175781,45.2580108642578,45.2580108642578,45.2580108642578,45.2580108642578,46.1357192993164,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266,47.3197174072266],"meminc":[0,0,0,0,0,0,0.245536804199219,0,0,0,0,0,0.574188232421875,0,0,0,0,0,0,0.353660583496094,0,0,0,0,0,0.272537231445312,0,0,0,0,0,0,0,0,0,0,0.209152221679688,0,0,0,0,0,0,0,3.02161407470703,0,0.670425415039062,0,0,0,0,0,0,0,0,0,0,0,0,0,1.43354797363281,0,0,0,0.868690490722656,0,0,0,0,1.30485534667969,0,0,0,0.877708435058594,1.18399810791016,0,0,0,0,0,0,0,0,0,0,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"interval":10,"files":[],"prof_output":"/tmp/RtmpPguRDA/file11b6d7410276e.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We’re way faster, taking less than half a second! Now the most time is spent on <code>raster::pointDistance</code>, which we call a ton of times. What does <code>pointDistance</code> do? It takes two pairs <code>(lat1, lon1)</code> and <code>(lat2, lon2)</code> the distance between them<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
</section>
<section id="gpx-reader-version-4-drop-into-rcpp" class="level2">
<h2 class="anchored" data-anchor-id="gpx-reader-version-4-drop-into-rcpp">GPX reader version 4: drop into Rcpp</h2>
<p>Next I Googled how to perform this calculation myself and found <a href="http://www.movable-type.co.uk/scripts/latlong.html#ellipsoid">this</a> and <a href="https://www.r-bloggers.com/great-circle-distance-calculations-in-r/">this</a>. The <code>Rcpp</code> implementation looks like:</p>
<div class="cell">
<pre class="rcpp cell-code"><code>#include &lt;Rcpp.h&gt;

using namespace Rcpp;

// [[Rcpp::export]]
double haversine_dist(const NumericVector p1, const NumericVector p2) {
  
  double lat1 = p1[0] * M_PI / 180;
  double lon1 = p1[1] * M_PI / 180;
  double lat2 = p2[0] * M_PI / 180;
  double lon2 = p2[1] * M_PI / 180;
  
  double d_lat = lat2 - lat1;
  double d_lon = lon2 - lon1;
  
  double a = pow(sin(d_lat / 2.0), 2) + 
    cos(lat1) * cos(lat2) * pow(sin(d_lon / 2.0), 2);
  double c = 2 * asin(std::min(1.0, sqrt(a)));
  
  return 6378137 * c; // 6378137 is the radius of the earth in meters
}</code></pre>
</div>
<p>The haversine distance is fast to calculate at the cost of some small error, which we can see below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>dist_expected <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">pointDistance</span>(p1, p2, <span class="at">lonlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>dist_result <span class="ot">&lt;-</span> <span class="fu">haversine_dist</span>(p1, p2)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>dist_result <span class="sc">-</span> dist_expected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 525.9688</code></pre>
</div>
</div>
<p>It turns out that “small error” on the geological scale is big error on the neighborhood run scale. Put all together, the C++ version looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>read_gpx4 <span class="ot">&lt;-</span> <span class="cf">function</span>(fname) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  gps_df <span class="ot">&lt;-</span> <span class="fu">read_gpx_xml</span>(fname)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_metrics</span>(gps_df, <span class="at">dist_func =</span> haversine_dist)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We profile one more time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>(<span class="fu">read_gpx4</span>(fname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-7e32def9488c122c2788" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-7e32def9488c122c2788">{"x":{"message":{"prof":{"time":[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,8,8],"depth":[4,3,2,1,8,7,6,5,4,3,2,1,6,5,4,3,2,1,4,3,2,1,6,5,4,3,2,1,12,11,10,9,8,7,6,5,4,3,2,1,1,2,1],"label":["lapply","xml_attrs.xml_nodeset","read_gpx_xml","read_gpx4","structure","FUN","lapply","make_nodeset","nodeset_apply.xml_nodeset","xml_children","read_gpx_xml","read_gpx4","xml_nodeset","make_nodeset","nodeset_apply.xml_nodeset","xml_children","read_gpx_xml","read_gpx4","vapply","xml_text.xml_nodeset","read_gpx_xml","read_gpx4","withCallingHandlers","mutate_cols","mutate.data.frame","mutate_at","get_metrics","read_gpx4","substr",".str_sub",".substitute_formats","<Anonymous>","mapply",".build_formats","guess_formats",".best_formats",".local_parse","parse_date_time",".parse_xxx_hms","<Anonymous>","attributes",".f","map2_dbl"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"memalloc":[36.2521591186523,36.2521591186523,36.2521591186523,36.2521591186523,36.5422286987305,36.5422286987305,36.5422286987305,36.5422286987305,36.5422286987305,36.5422286987305,36.5422286987305,36.5422286987305,37.2029876708984,37.2029876708984,37.2029876708984,37.2029876708984,37.2029876708984,37.2029876708984,37.4144821166992,37.4144821166992,37.4144821166992,37.4144821166992,37.7241668701172,37.7241668701172,37.7241668701172,37.7241668701172,37.7241668701172,37.7241668701172,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,39.6693954467773,41.1691436767578,44.7509307861328,44.7509307861328],"meminc":[0,0,0,0,0.290069580078125,0,0,0,0,0,0,0,0.660758972167969,0,0,0,0,0,0.211494445800781,0,0,0,0.309684753417969,0,0,0,0,0,1.94522857666016,0,0,0,0,0,0,0,0,0,0,0,1.49974822998047,3.581787109375,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},"interval":10,"files":[],"prof_output":"/tmp/RtmpPguRDA/file11b6d6911b813.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now it takes only about 0.1 seconds, but the result isn’t accurate enough anymore. I wasn’t in the mood to implement a more precise great circle distance calculation, but hopefully this illustrates the general principle of dropping into <code>Rcpp</code> and also why it’s important to test when profiling.</p>
</section>
<section id="comparing-the-various-gpx-readers" class="level2">
<h2 class="anchored" data-anchor-id="comparing-the-various-gpx-readers">Comparing the various GPX readers</h2>
<p>Now we can compare how long each version takes using the <code>bench</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_gpx0</span>(fname),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_gpx1</span>(fname),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_gpx2</span>(fname),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_gpx3</span>(fname),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_gpx4</span>(fname),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="dv">5</span>, <span class="co"># how many times to run everything. 5 is very low.</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">relative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">check =</span> <span class="cn">FALSE</span> <span class="co"># since readgpx4 isn't right, will error without this</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  expression         min median `itr/sec` mem_alloc `gc/sec`
  &lt;bch:expr&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 read_gpx0(fname)  2.88   3.03      5.64      1.09     1.06
2 read_gpx1(fname) 17.1   18.3       1         1.27     1   
3 read_gpx2(fname)  4.97   4.97      3.65      1.03     1.14
4 read_gpx3(fname)  1.59   1.60     11.2       1.00     1.40
5 read_gpx4(fname)  1      1        16.9       1        1.05</code></pre>
</div>
</div>
<p>Here timings are relative. We see that <code>read_gpx4</code> is about ten times faster than <code>read_gpx1</code> and two times faster than <code>read_gpx0</code>.</p>
</section>
<section id="embarrassing-parallelization-with-furrr" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="embarrassing-parallelization-with-furrr">Embarrassing parallelization with <code>furrr</code></h2>
<p>In the end, I needed to do this for about fifty files. Since we can process each file independently of the other files, this operation is <em>embarrassingly parallel</em>. I actually wanted to use this data, so I didn’t use the C++ haversine distance function. We can write with a single <code>map</code> call to process all the files at once:</p>
<div class="cell column-body-outset">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>run_files_subset <span class="ot">&lt;-</span> run_files[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(run_files_subset, read_gpx3, <span class="at">.id =</span> <span class="st">"run"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,780 × 11
   run     lon   lat time                seg…¹ seg…²      dx      dt speed  pace
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;drt&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 1     -95.4  29.7 2017-10-29 18:31:00     2 907 … 0.00250 2.78e-4  9.00  6.67
 2 1     -95.4  29.7 2017-10-29 18:31:01     2 907 … 0.00245 2.78e-4  8.81  6.81
 3 1     -95.4  29.7 2017-10-29 18:31:02     2 907 … 0.00234 2.78e-4  8.41  7.13
 4 1     -95.4  29.7 2017-10-29 18:31:03     2 907 … 0.00289 2.78e-4 10.4   5.77
 5 1     -95.4  29.7 2017-10-29 18:31:04     2 907 … 0.00341 2.78e-4 12.3   4.88
 6 1     -95.4  29.7 2017-10-29 18:31:05     2 907 … 0.00315 2.78e-4 11.4   5.29
 7 1     -95.4  29.7 2017-10-29 18:31:06     2 907 … 0.00761 2.78e-4 27.4   2.19
 8 1     -95.4  29.7 2017-10-29 18:31:08     2 907 … 0.00244 5.56e-4  4.39 13.7 
 9 1     -95.4  29.7 2017-10-29 18:31:09     2 907 … 0.00322 2.78e-4 11.6   5.18
10 1     -95.4  29.7 2017-10-29 18:31:11     2 907 … 0.00349 5.56e-4  6.28  9.55
# … with 11,770 more rows, abbreviated variable names ¹​segment, ²​seg_length,
#   and 1 more variable: elev &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Which means we can also write this as a parallelized <code>map</code> call with <code>furrr</code> like so:</p>
<div class="cell column-body-outset">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multiprocess, <span class="at">workers =</span> <span class="dv">12</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">future_map_dfr</span>(run_files, read_gpx3, <span class="at">.id =</span> <span class="st">"run"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 59,833 × 11
   run     lon   lat time                seg…¹ seg…²      dx      dt speed  pace
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;drt&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 1     -95.4  29.7 2017-10-29 18:31:00     2 907 … 0.00250 2.78e-4  9.00  6.67
 2 1     -95.4  29.7 2017-10-29 18:31:01     2 907 … 0.00245 2.78e-4  8.81  6.81
 3 1     -95.4  29.7 2017-10-29 18:31:02     2 907 … 0.00234 2.78e-4  8.41  7.13
 4 1     -95.4  29.7 2017-10-29 18:31:03     2 907 … 0.00289 2.78e-4 10.4   5.77
 5 1     -95.4  29.7 2017-10-29 18:31:04     2 907 … 0.00341 2.78e-4 12.3   4.88
 6 1     -95.4  29.7 2017-10-29 18:31:05     2 907 … 0.00315 2.78e-4 11.4   5.29
 7 1     -95.4  29.7 2017-10-29 18:31:06     2 907 … 0.00761 2.78e-4 27.4   2.19
 8 1     -95.4  29.7 2017-10-29 18:31:08     2 907 … 0.00244 5.56e-4  4.39 13.7 
 9 1     -95.4  29.7 2017-10-29 18:31:09     2 907 … 0.00322 2.78e-4 11.6   5.18
10 1     -95.4  29.7 2017-10-29 18:31:11     2 907 … 0.00349 5.56e-4  6.28  9.55
# … with 59,823 more rows, abbreviated variable names ¹​segment, ²​seg_length,
#   and 1 more variable: elev &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Note that other than loading <code>furrr</code> and calling <code>plan(multiprocess)</code> all we’ve had to do to get parallelism is to call <code>furrr::future_map_dfr</code>, which has exactly the same API as <code>purrr::map_dfr</code>. My computer has twelve cores, meaning there’s a maximum possible speedup of twelve.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mark</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sequential =</span> <span class="fu">map_dfr</span>(run_files, read_gpx3, <span class="at">.id =</span> <span class="st">"run"</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="fu">future_map_dfr</span>(run_files, read_gpx3, <span class="at">.id =</span> <span class="st">"run"</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="dv">5</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">memory =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">relative =</span> <span class="cn">TRUE</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  expression   min median `itr/sec` mem_alloc `gc/sec`
  &lt;bch:expr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 sequential  5.00   4.55      1           NA     1   
2 parallel    1      1         4.50        NA     4.10</code></pre>
</div>
</div>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap Up</h2>
<p>This was a low stakes exercise in speeding up R code. By the time I’d written all of these it would have been several hundred times faster to use <code>read_gpx0</code> and just save the results to a <code>.rds</code> file. Still, it was fun to work through the profiling workflow and I look forward to enterprising strangers on the internet pointing out places where things can get faster still.</p>
<p>See also <a href="https://cran.r-project.org/package=gpx"><code>gpx</code></a> for a more modern approach to reading <code>.gpx</code> files in R that did not exist at the time I originally wrote this blogpost.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>It took me a two months to realize this, mostly because I didn’t plot enough of the data. If you’re curous how Strava detects paused movement, you can read more <a href="https://medium.com/strava-engineering/improving-auto-pause-for-everyone-13f253c66f9e">here</a>. It seems to involve more if-statements than fun models.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>We can’t calculate the distance using the L2 norm because longitude and latitude are spherical coordinates, not Euclidean coordinates.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.alexpghayes\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="alexpghayes/quarto-blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/alexpghayes/quarto-blog/edit/main/post/2018-06-15_speeding-up-gpx-ingest-profiling-rcpp-and-furrr/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/alexpghayes/quarto-blog/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/alexpghayes/quarto-blog">
<p>website source</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>